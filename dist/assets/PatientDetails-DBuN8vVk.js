import{m as w,r as d,f as v,j as e,b as f,c as g}from"./index-m2i5zgkR.js";const D=()=>{const{id:h}=w(),[s,c]=d.useState(null),[b,u]=d.useState(!0),[j,y]=d.useState(null),{toast:n}=v(),[x,m]=d.useState(!1);d.useEffect(()=>{(async()=>{u(!0);try{const a=f.get("auth");let r="";if(a)try{r=JSON.parse(a).token}catch{r=""}if(!h){console.error("Patient ID is missing."),u(!1);return}const i=await g.get(`/doctors/user?userId=${h}`,{headers:{Authorization:`Bearer ${r}`}});i.data.success?c(i.data.data):(console.error("Failed to fetch patient details:",i.data),c(null))}catch(a){console.error("Error fetching patient details:",a),c(null)}finally{u(!1)}})()},[h]);const l=t=>{const a={year:"numeric",month:"short",day:"numeric"};return new Date(t).toLocaleDateString(void 0,a)},N=async()=>{var t;if(s){m(!0);try{const a=f.get("auth");let r="";if(a)try{r=JSON.parse(a).token}catch{r=""}const i=await g.post(`/doctors/assign-course?userId=${s.id}`,{},{headers:{Authorization:`Bearer ${r}`}});i.data&&i.data.success?(n({title:"Success",description:"Course assigned successfully!",variant:"default",className:"bg-green-500 text-white"}),c({...s,isCourseAssigned:!0})):n({title:"Error",description:((t=i.data)==null?void 0:t.message)||"Failed to assign course.",variant:"destructive"})}catch{n({title:"Error",description:"Failed to assign course.",variant:"destructive"})}finally{m(!1)}}};return b?e.jsx("div",{className:"flex justify-center items-center h-screen text-xl",children:"Loading patient details..."}):s?e.jsxs("div",{className:"p-4 md:p-8 bg-[#FAF8FB] min-h-screen font-['Poppins']",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-6 mb-8 shadow flex flex-col md:flex-row items-center md:items-start gap-6 border border-gray-100",children:[e.jsx("div",{className:"w-28 h-28 rounded-full bg-[#8B2D6C1A] flex items-center justify-center text-[#8B2D6C] font-semibold text-4xl overflow-hidden border-4 border-[#8B2D6C]",children:s.profilePicture?e.jsx("img",{src:s.profilePicture,alt:s.name,className:"w-full h-full object-cover"}):s.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 flex flex-col gap-2",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-[#1A2343] mb-1",children:s.name}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-1 text-gray-700 text-base",children:[e.jsxs("span",{children:[e.jsx("span",{className:"font-semibold",children:"Email:"})," ",s.email]}),e.jsxs("span",{children:[e.jsx("span",{className:"font-semibold",children:"Phone:"})," ",s.countryCode," ",s.phoneNumber]}),e.jsxs("span",{children:[e.jsx("span",{className:"font-semibold",children:"Gender:"})," ",s.gender]}),e.jsxs("span",{children:[e.jsx("span",{className:"font-semibold",children:"DOB:"})," ",l(s.dob)]}),e.jsxs("span",{children:[e.jsx("span",{className:"font-semibold",children:"Created:"})," ",l(s.createdAt)]}),e.jsxs("span",{children:[e.jsx("span",{className:"font-semibold",children:"Updated:"})," ",l(s.updatedAt)]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 mb-8 shadow border border-gray-100",children:[s.tests.length>0&&e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("h2",{className:"text-xl md:text-2xl font-semibold text-gray-800",children:["Total Assessments Cycles done ",e.jsxs("span",{className:"text-[#8B2D6C]",children:["(",s.tests.length,")"]})]})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-1",children:[s.tests.length===0&&e.jsx("div",{className:"text-gray-500",children:"No tests available."}),s.tests.map(t=>{const a=j===t.id;return e.jsxs("div",{className:"bg-[#FBF9FF] rounded-xl shadow-sm border border-[#E9D8F4]",children:[e.jsxs("button",{className:"w-full flex items-center justify-between px-5 py-4 focus:outline-none",onClick:()=>y(a?null:t.id),"aria-expanded":a,"aria-controls":`test-details-${t.id}`,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"font-semibold text-[#8B2D6C] text-lg",children:["Cycle: ",t.cycle]}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Tests Completed: ",t.testsCompleted]})]}),e.jsx("svg",{className:`w-5 h-5 text-[#8B2D6C] transform transition-transform duration-200 ${a?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})]}),a&&e.jsxs("div",{id:`test-details-${t.id}`,className:"px-5 pb-5 pt-2 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-2",children:[e.jsxs("div",{className:"mb-2 md:mb-0",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["Created: ",l(t.createdAt)]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Updated: ",l(t.updatedAt)]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 md:gap-3",children:[t.reportView&&e.jsx("a",{href:t.reportView,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1 rounded-full bg-gradient-to-r from-[#8B2D6C] to-[#C6426E] text-white text-sm font-semibold shadow hover:opacity-90 transition",children:"View Report"}),t.detailedReportView&&e.jsx("a",{href:t.detailedReportView,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1 rounded-full bg-gradient-to-r from-[#8B2D6C] to-[#C6426E] text-white text-sm font-semibold shadow hover:opacity-90 transition",children:"View Detailed"})]})]}),e.jsx("div",{className:"flex flex-col md:flex-row gap-6 mt-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-gray-700 mb-1",children:"Test Scores:"}),e.jsx("ul",{className:"list-disc ml-6 text-sm text-gray-800",children:Object.entries(t.rawScores).map(([r,i])=>e.jsxs("li",{children:[r,": ",i]},r))})]})}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:async()=>{var r;m(!0);try{const i=f.get("auth");let o="";if(i)try{o=JSON.parse(i).token}catch{o=""}const p=await g.post(`/doctors/reassign-tests?userId=${s.id}`,{},{headers:{Authorization:`Bearer ${o}`}});p.data&&p.data.success?n({title:"Success",description:"Test cycle reassigned successfully!",variant:"default",className:"bg-green-500 text-white"}):n({title:"Error",description:((r=p.data)==null?void 0:r.message)||"Failed to reassign test cycle.",variant:"destructive"})}catch{n({title:"Error",description:"Failed to reassign test cycle.",variant:"destructive"})}finally{m(!1)}},disabled:x,className:"px-5 py-2 rounded-full bg-gradient-to-r from-[#8B2D6C] to-[#C6426E] text-white font-semibold shadow hover:opacity-90 transition disabled:opacity-60",children:x?"Reassigning...":"Retake the Test"})})]})]},t.id)})]})]}),s.isCourseAssigned&&e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow border border-gray-100",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Course Assigned"}),e.jsx("p",{className:"text-gray-700",children:"A course has been assigned to this patient."})]}),!s.isCourseAssigned&&e.jsx("div",{className:" rounded-2xl p-6  border border-gray-100 mt-4",children:e.jsx("button",{onClick:N,disabled:x,className:"px-6 py-3 rounded-full bg-gradient-to-r from-[#8B2D6C] to-[#C6426E] text-white font-semibold text-lg shadow hover:opacity-90 transition disabled:opacity-60",children:x?"Assigning...":"Assign Course"})})]}):e.jsx("div",{className:"flex justify-center items-center h-screen text-xl text-red-600",children:"Patient not found or an error occurred."})};export{D as default};
