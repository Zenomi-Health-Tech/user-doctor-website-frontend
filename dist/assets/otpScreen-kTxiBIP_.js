import{f as S,r as k,u as C,a as h,j as t,B as R}from"./index-_jotthW6.js";import{u as B,L as E,t as L,z as x,C as D}from"./index-8pjQrvMk.js";import{u as a,B as A}from"./bgLogo-BBRmjqJD.js";const V=x.object({otp:x.string().length(6,{message:"OTP must be exactly 6 digits"}).regex(/^\d+$/,{message:"OTP must only contain digits"})}),z=({onSuccess:o})=>{const{handleSubmit:c,setValue:y,watch:d,formState:{errors:u}}=B({resolver:L(V),defaultValues:{otp:""}}),b=a(e=>e.resendOtpLogin),j=a(e=>e.validateOtp),m=a(e=>e.error),p=a(e=>e.loading),v=a(e=>e.phoneNumber),{toast:n}=S(),i=Array(6).fill(0).map(()=>k.useRef(null)),{user:l}=C(),O=h(),N=async({otp:e})=>{try{const s=await j(e);if(console.log("OTP validation result:",s),s)n({title:"Success",description:"OTP verified successfully!",variant:"default",className:"bg-green-500 text-white"}),l&&l.type==="DOCTOR"&&l.isPaid===!1?O("/doctor/payment-onboard"):(o(),window.location.reload());else{const r=m||"Invalid OTP. Please try again.";n({title:"Error",description:r,variant:"destructive"}),console.log("OTP verification failed:",{otp:e,error:r})}}catch(s){console.error("Unexpected error during OTP verification:",s),n({title:"Error",description:"An unexpected error occurred. Please try again.",variant:"destructive"})}},w=async()=>{try{await b(),n({title:"Success",description:"OTP sent again successfully!",variant:"default"})}catch{console.error("Resend OTP error:",m),n({title:"Error",description:"Failed to resend OTP.",variant:"destructive"})}},P=(e,s)=>{var f;s.length>1&&(s=s[0]);const g=(d("otp")||"").split("");g[e]=s,y("otp",g.join("")),s&&e<5&&((f=i[e+1].current)==null||f.focus())},T=(e,s)=>{var r;s.key==="Backspace"&&!d("otp")[e]&&e>0&&((r=i[e-1].current)==null||r.focus())};return t.jsxs("form",{onSubmit:c(N),className:"w-full space-y-6 font-['Poppins']",children:[t.jsxs("div",{className:"text-center space-y-4",children:[t.jsx("h1",{className:"text-2xl font-semibold",children:"Verify your OTP"}),t.jsxs("p",{className:"text-gray-600",children:["Enter the 6-digit code sent to ",v]})]}),t.jsx("div",{className:"flex justify-center gap-3",children:Array(6).fill(0).map((e,s)=>t.jsx("input",{type:"text",maxLength:1,ref:i[s],onChange:r=>P(s,r.target.value),onKeyDown:r=>T(s,r),className:"w-12 h-12 text-center text-lg font-semibold border rounded-full focus:outline-none focus:ring-2 focus:ring-purple-600 focus:border-transparent"},s))}),u.otp&&t.jsx("p",{className:"text-red-500 text-sm text-center",children:u.otp.message}),t.jsxs("div",{className:"text-center text-sm",children:[t.jsx("span",{className:"text-gray-600",children:"Didn't get it? "}),t.jsx("button",{type:"button",onClick:w,className:"text-purple-600 font-medium hover:text-purple-700",children:"Resend"})]}),t.jsx(R,{type:"submit",disabled:p,className:"w-full h-12 text-white rounded-xl transition-colors font-medium",style:{background:"linear-gradient(89.79deg, #704180 5.07%, #8B2D6C 95.83%)"},children:p?t.jsxs("div",{className:"flex items-center justify-center",children:[t.jsx(E,{className:"animate-spin h-5 w-5 mr-2"}),t.jsx("span",{children:"Verifying..."})]}):"Send OTP"})]})};function $(){const o=h(),c=()=>{o("/doctor/register")};return t.jsxs("div",{className:"flex items-center justify-center min-h-screen bg-gray-100 dark:bg-gray-900 relative",style:{backgroundImage:`linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url(${A})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},children:[t.jsx("div",{className:"absolute inset-0"}),t.jsx(D,{className:"bg-white/95 backdrop-blur-sm rounded-3xl w-[439px] shadow-xl z-10 p-8",children:t.jsx("div",{className:"w-full max-w-md mx-auto flex flex-col items-center",children:t.jsx(z,{onSuccess:c})})})]})}export{$ as default};
