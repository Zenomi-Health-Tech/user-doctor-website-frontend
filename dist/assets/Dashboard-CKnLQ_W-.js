import{r as i,u as G,a as X,j as e,b as A,c as z,d as g}from"./index-Rk6L4tHA.js";const Z="/assets/user-tick-BGf2NAhT.png",ee="/assets/yellowcal-B0IebFgv.png",te="/assets/purplecal-BatwHKTq.png",se="/assets/greencal-CWWh9JF6.png",ae=["Start Your Daily Mental Health Check-In","Review Your Recent Test Results","Talk to a Mental Health Expert"];function le(){var L,q;const[x,b]=i.useState([]),[$,y]=i.useState(!0),[r,f]=i.useState(null),[E,P]=i.useState(null),[O,N]=i.useState(!1),[m,M]=i.useState([]),[R,S]=i.useState(!1),[s,w]=i.useState(0),[d,B]=i.useState([]),[U,v]=i.useState(!1),[h,Q]=i.useState(null),{isDoctor:u,userName:C}=G(),[F,k]=i.useState([]),[I,T]=i.useState(!0),H=X();console.log(u,"isDoctor"),i.useEffect(()=>{(async()=>{var a,n,l;y(!0);try{const c=A.get("auth");let p="";if(c)try{p=JSON.parse(c).token}catch{p=""}if(console.log("isDoctor value:",u),console.log("Token:",p),u){console.log("Attempting to fetch doctor analytics...");try{const o=await z.get("/doctors/analytics/home",{headers:{Authorization:`Bearer ${p}`}});console.log("Doctor analytics response:",o),console.log("Response data:",o.data),Q(o.data.data)}catch(o){console.error("Error fetching doctor analytics:",o),g.isAxiosError(o)&&console.error("Axios error details:",{status:(a=o.response)==null?void 0:a.status,data:(n=o.response)==null?void 0:n.data,headers:(l=o.response)==null?void 0:l.headers})}}else{const o=await g.get("https://zenomiai.elitceler.com/api/testnames",{headers:{Authorization:`Bearer ${p}`}});console.log("API Response:",o.data),Array.isArray(o.data)?b(o.data):(console.error("Unexpected API response format:",o.data),b([]))}}catch(c){console.error("Error in fetchData:",c),b([])}finally{y(!1)}})()},[u]),i.useEffect(()=>{(async()=>{T(!0);try{const a=await z.get("/admin/get-todays-appointments");a.data.success?k(a.data.data):k([])}catch{k([])}finally{T(!1)}})()},[]);const D=((L=x==null?void 0:x.filter(t=>(t==null?void 0:t.testStatus)==="COMPLETED"))==null?void 0:L.length)||0;console.log(D);const W=async()=>{if(r){S(!0);try{const t=A.get("auth");let a="";if(t)try{a=JSON.parse(t).token}catch{a=""}const n=await g.get(`https://zenomiai.elitceler.com/questions/${r.id}`,{headers:{Authorization:`Bearer ${a}`}});console.log(n.data,"res of questions"),n.data&&Array.isArray(n.data)?(M(n.data),P(r.id),N(!0),w(0),B([]),f(null)):(console.error("Invalid questions data format:",n.data),alert("Failed to load questions. Please try again."))}catch(t){console.error("Failed to fetch questions:",t),alert("Failed to load questions. Please try again.")}finally{S(!1)}}},j=t=>{const a=m[s],n=[...d];n.length<=s&&(n.length=s+1);let l=t;a.questionType==="SCALE"?l=t.split(":")[0]:Array.isArray(t)&&(l=t[0]),n[s]={question:a.question,answer:l},B(n)},K=()=>{if(s<m.length-1){if(!d[s]||!d[s].answer){alert("Please answer the current question before proceeding.");return}w(s+1)}else{if(!d[s]||!d[s].answer){alert("Please answer the last question before submitting.");return}V()}},Y=()=>{s>0&&w(s-1)},J=()=>{N(!1),v(!1),f(null),window.location.reload()},V=async()=>{if(!E)return;const t=A.get("auth");let a="";if(t)try{a=JSON.parse(t).token}catch{a=""}try{const n=d.map(c=>({question:c.question,answer:c.answer}));console.log("Submitting answers:",n),await g.post(`https://zenomiai.elitceler.com/score-test/${E}`,{answers:n},{headers:{Authorization:`Bearer ${a}`}}),N(!1),v(!0);const l=await g.get("https://zenomiai.elitceler.com/api/testnames",{headers:{Authorization:`Bearer ${a}`}});b(l.data),P(null)}catch(n){console.error("Failed to submit quiz:",n),alert("Failed to submit quiz. Please try again.")}finally{y(!1)}};console.log(r==null?void 0:r.id);const _=t=>{H(`/patients/${t}`)};return $?e.jsx("div",{children:"Loading..."}):!Array.isArray(x)&&!u?(console.error("Tests is not an array:",x),e.jsx("div",{children:"Error loading tests. Please try again."})):(console.log(h,"doctorAnalytics"),e.jsxs("div",{className:"flex justify-center gap-8 p-8  min-h-screen font-['Poppins']",children:[u?e.jsxs("div",{className:"w-full font-['Poppins']",children:[e.jsxs("h2",{className:"text-2xl font-semibold mb-6 font-['Urbanist']",children:[e.jsx("span",{role:"img","aria-label":"wave",children:"ðŸ‘‹"})," Hey Dr. ",C||"Joseph"]}),h&&e.jsxs("div",{className:"grid grid-cols-4 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-[#8B2D6C05] rounded-2xl p-6 flex flex-col items-center justify-center shadow",children:[e.jsx("img",{src:Z,alt:"Patients",className:"w-12 h-12 mb-2"}),e.jsx("span",{className:"text-2xl font-medium text-[#5E5F60]",children:h.totalReferredPatients}),e.jsx("p",{className:"text-gray-600 text-md",children:"Total patients"})]}),e.jsxs("div",{className:"bg-[#FBF9FF] rounded-2xl p-6 flex flex-col items-center justify-center shadow",children:[e.jsx("img",{src:te,alt:"Reports",className:"w-12 h-12 mb-2"}),e.jsx("span",{className:"text-2xl font-medium text-[#5E5F60]",children:h.reportsGeneratedCount}),e.jsx("p",{className:"text-gray-600 text-md",children:"Reports generated"})]}),e.jsxs("div",{className:"bg-[#FCB35B14] rounded-2xl p-6 flex flex-col items-center justify-center shadow",children:[e.jsx("img",{src:ee,alt:"Appointments",className:"w-12 h-12 mb-2"}),e.jsx("span",{className:"text-2xl font-medium text-[#5E5F60]",children:h.appointmentsTodayCount}),e.jsx("p",{className:"text-gray-600 text-md",children:"Appointments"})]}),e.jsxs("div",{className:"bg-[#A9F20014] rounded-2xl p-6 flex flex-col items-center justify-center shadow",children:[e.jsx("img",{src:se,alt:"Referral Patients",className:"w-12 h-12 mb-2"}),e.jsx("span",{className:"text-2xl font-medium text-[#5E5F60]",children:h.pendingAppointmentsCount}),e.jsx("p",{className:"text-gray-600 text-md",children:"Referral patients"})]})]}),e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Today's Appointments"}),e.jsx("div",{className:"space-y-4",children:I?e.jsx("div",{className:"text-gray-500",children:"Loading..."}):F.length===0?e.jsx("div",{className:"text-gray-500",children:"No appointments for today."}):F.map(t=>{var a;return e.jsxs("div",{onClick:()=>_(t.userId),className:"bg-[#F8F3FA] cursor-pointer rounded-2xl p-4 flex items-center justify-between shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"bg-[#E5E0EA] p-3 rounded-full",children:e.jsx("svg",{className:"w-6 h-6 text-[#704180]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-800",children:((a=t.user)==null?void 0:a.name)||"Unknown"}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date(t.preferredTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})})]})]}),e.jsx("span",{className:"text-gray-500 text-sm",children:t.status}),e.jsx("button",{className:"p-2 rounded-full bg-[#E5E0EA] text-[#8B2D6C] hover:bg-[#D5CCD6]",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})})})]},t.id)})})]}):e.jsxs("div",{className:"flex-1 max-w-[650px] font-['Poppins']",children:[e.jsxs("h2",{className:"text-2xl font-semibold mb-2 font-['Urbanist']",children:[e.jsx("span",{role:"img","aria-label":"wave",children:"ðŸ‘‹"})," ","Hey ",e.jsx("span",{className:"text-[#8B2D6C] font-bold font-['Urbanist']",children:C||"there"}),", ready to check in with yourself today?"]}),e.jsxs("div",{className:"mb-6 font-['Poppins']",children:[e.jsx("div",{className:"flex justify-between text-sm text-gray-500 mb-1 font-['Poppins']",children:e.jsxs("span",{children:[D," of ",x.length," completed"]})}),e.jsx("div",{className:"w-full h-2 bg-gray-200 rounded-full",children:e.jsx("div",{className:"h-2 rounded-full bg-gradient-to-r from-[#704180] to-[#8B2D6C]",style:{width:`${x.length?D/x.length*100:0}%`}})})]}),e.jsx("div",{className:"flex flex-col gap-6 font-['Poppins']",children:x==null?void 0:x.map(t=>e.jsxs("div",{className:`rounded-3xl p-6 relative font-['Poppins'] ${t.testStatus==="COMPLETED"?"bg-gradient-to-r from-[#704180] to-[#8B2D6C]":t.testStatus==="UNLOCKED"?"bg-gradient-to-r from-[#704180] to-[#8B2D6C] opacity-80":"bg-gray-200 opacity-80"}`,children:[e.jsxs("div",{className:"flex items-center gap-6 font-['Poppins']",children:[e.jsx("img",{src:t.image_url,alt:t.name,className:"w-28 h-28 rounded-2xl object-cover"}),e.jsxs("div",{children:[e.jsx("h3",{className:`text-xl font-bold font-['Poppins'] ${t.testStatus==="COMPLETED"?"text-white":"text-gray-300"}`,children:t.name}),e.jsx("p",{className:`text-base font-['Poppins'] ${t.testStatus==="COMPLETED"?"text-white":"text-gray-300"}`,children:t.description||"No description available"}),e.jsx("button",{className:`mt-4 px-6 py-2 rounded-full font-semibold text-base font-['Poppins']
                        ${t.testStatus==="COMPLETED"||t.testStatus==="UNLOCKED"?"bg-white text-[#704180] hover:bg-gray-100":"bg-gray-400 text-gray-200 cursor-not-allowed"}`,onClick:()=>f(t),disabled:!(t.testStatus==="COMPLETED"||t.testStatus==="UNLOCKED"),children:"Take test"})]})]}),t.testStatus!=="COMPLETED"&&t.testStatus!=="UNLOCKED"&&e.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-black bg-opacity-40 rounded-3xl font-['Poppins']",children:e.jsxs("span",{className:"text-white text-lg font-bold font-['Poppins']",children:[e.jsx("span",{role:"img","aria-label":"lock",children:"ðŸ”’"})," ",t.testStatus==="UNLOCKED"?`Complete the ${t.name} to unlock`:"Locked"]})})]},t.id))})]}),!u&&e.jsxs("div",{className:"w-[450px] bg-white rounded-3xl shadow p-8 flex flex-col items-center font-['Poppins']",children:[e.jsx("div",{className:"mb-4 font-['Poppins']",children:e.jsxs("svg",{width:"80",height:"80",children:[e.jsx("circle",{cx:"40",cy:"40",r:"36",stroke:"#E5E0EA",strokeWidth:"8",fill:"none"}),e.jsx("circle",{cx:"40",cy:"40",r:"36",stroke:"#704180",strokeWidth:"8",fill:"none",strokeDasharray:2*Math.PI*36,strokeDashoffset:2*Math.PI*36*(1-0/3),strokeLinecap:"round"}),e.jsx("text",{x:"50%",y:"50%",textAnchor:"middle",dy:".3em",fontSize:"1.2em",fill:"#704180",fontWeight:"bold",className:"font-['Poppins']",children:"0/3"})]})}),e.jsxs("h3",{className:"text-lg font-semibold mb-2 text-center font-['Poppins']",children:["Welcome to Zenomi ,",e.jsx("span",{className:"text-[#8B2D6C] font-bold font-['Poppins']",children:C||"Lily"})]}),e.jsx("p",{className:"text-gray-500 text-center mb-6 font-['Poppins']",children:"Experience your AHA! moment by completing this simple steps"}),e.jsx("ul",{className:"w-full space-y-3 font-['Poppins']",children:ae.map(t=>e.jsxs("li",{className:"flex items-center justify-between px-4 py-2 rounded-lg bg-gray-100 text-gray-700 font-['Poppins']",children:[e.jsx("span",{children:t}),e.jsx("span",{className:"w-6 h-6 flex items-center justify-center rounded-full bg-white border border-gray-300 text-gray-400 font-['Poppins']",children:"âœ”ï¸"})]},t))})]}),r&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40",children:e.jsxs("div",{className:"bg-white rounded-3xl p-10 w-full max-w-lg shadow-lg flex flex-col items-center relative font-['Urbanist']",children:[e.jsx("button",{className:"absolute top-4 right-4 text-2xl text-gray-400 hover:text-gray-600",onClick:()=>f(null),children:"Ã—"}),e.jsx("img",{src:r.image_url,alt:r.name,className:"w-24 h-24 mb-4"}),e.jsxs("h2",{className:"text-2xl font-bold mb-2 text-center",children:["Ready for Your ",r.name,"?"]}),e.jsx("p",{className:"text-gray-600 text-center mb-6",children:r.description||"No description available"}),e.jsxs("div",{className:"flex justify-center flex-wrap gap-3 mb-8",children:[e.jsxs("span",{className:"bg-[#F3EAF7] text-[#704180] px-4 py-2 rounded-full flex items-center gap-2 text-sm font-medium",children:[e.jsx("span",{role:"img","aria-label":"timer",children:"â±"})," Takes 3 mins"]}),e.jsxs("span",{className:"bg-[#F3EAF7] text-[#704180] px-4 py-2 rounded-full flex items-center gap-2 text-sm font-medium",children:[e.jsx("span",{role:"img","aria-label":"questions",children:"ðŸ“‹"})," ",r.question_count," Questions"]}),e.jsxs("span",{className:"bg-[#F3EAF7] text-[#704180] px-4 py-2 rounded-full flex items-center gap-2 text-sm font-medium",children:[e.jsx("span",{role:"img","aria-label":"results",children:"ðŸŽ¯"})," Personalized Results"]})]}),e.jsx("button",{className:"w-full py-3 rounded-full text-white font-semibold text-lg mb-3",style:{background:"linear-gradient(90deg, #704180 6.54%, #8B2D6C 90.65%)"},onClick:W,children:"Start test"}),e.jsx("button",{className:"w-full py-3 rounded-full border border-[#8B2D6C] text-[#8B2D6C] font-semibold text-lg",onClick:()=>f(null),children:"Cancel"})]})}),O&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 overflow-y-auto py-8",children:e.jsxs("div",{className:"bg-[#F8F3FA] rounded-3xl p-10 w-full max-w-2xl shadow-lg flex flex-col items-center relative my-8",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-2 text-left w-full",children:[(r==null?void 0:r.name)||"Test"," Quiz"]}),R?e.jsx("div",{className:"flex items-center justify-center h-[350px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#8B2D6C] mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading questions..."})]})}):m.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full flex items-center mb-6",children:e.jsx("div",{className:"flex-1 h-3 bg-gray-200 rounded-full",children:e.jsx("div",{className:"h-3 rounded-full bg-gradient-to-r from-[#F3C96B] to-[#E5E0EA]",style:{width:`${(s+1)/m.length*100}%`}})})}),e.jsxs("div",{className:"w-full bg-[#F8F3FA] rounded-2xl p-8 flex flex-col items-center",children:[e.jsxs("div",{className:"text-center mb-4 text-gray-700 font-semibold",children:["Question ",String(s+1).padStart(2,"0"),"/",m.length]}),e.jsx("div",{className:"text-center text-xl font-bold mb-8",children:(q=m[s])==null?void 0:q.question}),e.jsx("div",{className:"flex flex-col gap-4 w-full max-w-xl",children:(()=>{var a,n;const t=m[s];return t?t.questionType==="NUMBER"?e.jsx("input",{type:"number",className:"w-full py-4 rounded-full border-2 border-[#8B2D6C] text-lg font-medium px-6",value:((a=d[s])==null?void 0:a.answer)||"",onChange:l=>j(l.target.value)}):t.questionType==="BOOLEAN"?e.jsx("div",{className:"flex gap-4",children:["Yes","No"].map(l=>{var c;return e.jsx("button",{className:`flex-1 py-4 rounded-full border-2 text-lg font-medium ${((c=d[s])==null?void 0:c.answer)===l?"bg-gradient-to-r from-[#704180] to-[#8B2D6C] text-white":"border-[#8B2D6C] text-[#704180] bg-white"}`,onClick:()=>j(l),children:l},l)})}):t.questionType==="TEXT"?e.jsx("textarea",{className:"w-full py-4 rounded-2xl border-2 border-[#8B2D6C] text-lg font-medium px-6",rows:4,value:((n=d[s])==null?void 0:n.answer)||"",onChange:l=>j(l.target.value)}):(t.scaleOptions||[]).map(l=>{var c;return e.jsx("button",{className:`w-full py-4 rounded-full border-2 text-lg font-medium ${((c=d[s])==null?void 0:c.answer)===l.split(":")[0]?"bg-gradient-to-r from-[#704180] to-[#8B2D6C] text-white":"border-[#8B2D6C] text-[#704180] bg-white"}`,onClick:()=>j(l),children:l.split(":")[0]},l)}):null})()}),e.jsxs("div",{className:"flex justify-between w-full mt-8",children:[e.jsx("button",{className:"px-8 py-2 rounded-full border-2 border-[#8B2D6C] text-[#8B2D6C] font-medium",onClick:Y,disabled:s===0,children:"Previous"}),e.jsx("button",{className:"px-8 py-2 rounded-full bg-gradient-to-r from-[#704180] to-[#8B2D6C] text-white font-medium",onClick:K,disabled:!d[s]||!d[s].answer,children:s===m.length-1?"Submit":"Next"})]})]})]}):e.jsx("div",{className:"flex items-center justify-center h-[350px]",children:e.jsx("p",{className:"text-gray-600",children:"No questions available"})})]})}),U&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40",children:e.jsxs("div",{className:"bg-white rounded-3xl p-10 w-full max-w-lg shadow-lg flex flex-col items-center relative",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2 text-center",children:"You've Completed the Sleep Test!"}),e.jsx("p",{className:"text-gray-600 text-center mb-6",children:"Your results are ready and personalized just for you."}),e.jsx("button",{className:"w-full py-3 rounded-full text-white font-semibold text-lg mb-3",style:{background:"linear-gradient(90deg, #704180 6.54%, #8B2D6C 90.65%)"},onClick:()=>J(),children:"Back to homescreen"}),e.jsx("button",{className:"w-full py-3 rounded-full border border-[#8B2D6C] text-[#8B2D6C] font-semibold text-lg",onClick:()=>v(!1),children:"Take next test"})]})})]}))}const re=()=>e.jsx(le,{});export{re as default};
